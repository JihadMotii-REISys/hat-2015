# -*- mode: ruby -*-

dir = File.dirname(File.expand_path(__FILE__))
vagrantPath = "conf/vagrant"

require 'yaml'
require "#{dir}/#{vagrantPath}/puphpet/ruby/deep_merge.rb"

configValues = YAML.load_file("#{dir}/#{vagrantPath}/puphpet/config.yaml")

if File.file?("#{dir}/#{vagrantPath}/puphpet/config-custom.yaml")
  custom = YAML.load_file("#{dir}/#{vagrantPath}/puphpet/config-custom.yaml")
  configValues.deep_merge!(custom)
end

data = configValues['vagrantfile']

Vagrant.require_version '>= 1.6.0'

eval File.read("#{dir}/#{vagrantPath}/puphpet/vagrant/Vagrantfile-#{data['target']}")

Vagrant.configure("2") do |config|
  config.vm.provision "shell", path: "#{dir}/scripts/provisioning/dev-dependencies.sh"
end